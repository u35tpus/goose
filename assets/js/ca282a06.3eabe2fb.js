/*! For license information please see ca282a06.3eabe2fb.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkgoose=globalThis.webpackChunkgoose||[]).push([[8380],{11470:(e,n,t)=>{t.d(n,{A:()=>k});var i=t(96540),s=t(34164),r=t(17559),o=t(23104),a=t(56347),l=t(205),c=t(57485),d=t(31682),h=t(70679);function u(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,i.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:i}})=>({value:e,label:n,attributes:t,default:i}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function g({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(s),(0,i.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,r=p(e),[o,a]=(0,i.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r})),[c,d]=m({queryString:t,groupId:s}),[u,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,h.Dv)(n);return[t,(0,i.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),x=(()=>{const e=c??u;return g({value:e,tabValues:r})?e:null})();(0,l.A)(()=>{x&&a(x)},[x]);return{selectedValue:o,selectValue:(0,i.useCallback)(e=>{if(!g({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);a(e),d(e),f(e)},[d,f,r]),tabValues:r}}var x=t(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function y({className:e,block:n,selectedValue:t,selectValue:i,tabValues:r}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),c=e=>{const n=e.currentTarget,s=a.indexOf(n),o=r[s].value;o!==t&&(l(n),i(o))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:i})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...i,className:(0,s.A)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===t);return e?(0,i.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function w(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,s.A)(r.G.tabs.container,"tabs-container",j.tabList),children:[(0,b.jsx)(y,{...n,...e}),(0,b.jsx)(v,{...n,...e})]})}function k(e){const n=(0,x.A)();return(0,b.jsx)(w,{...e,children:u(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var i=t(34164);const s={tabItem:"tabItem_Ymn6"};var r=t(74848);function o({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)(s.tabItem,t),hidden:n,children:e})}},27951:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"guides/security/prompt-injection-detection","title":"Prompt Injection Detection","description":"Protect your workflow by detecting potentially harmful commands before they run.","source":"@site/docs/guides/security/prompt-injection-detection.md","sourceDirName":"guides/security","slug":"/guides/security/prompt-injection-detection","permalink":"/goose/docs/guides/security/prompt-injection-detection","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Prompt Injection Detection","sidebar_label":"Prompt Injection Detection","description":"Protect your workflow by detecting potentially harmful commands before they run."},"sidebar":"tutorialSidebar","previous":{"title":"Staying Safe with goose","permalink":"/goose/docs/guides/security/"},"next":{"title":"Classification API Specification","permalink":"/goose/docs/guides/security/classification-api-spec"}}');var s=t(74848),r=t(28453),o=t(11470),a=t(19365),l=t(71112);const c={sidebar_position:1,title:"Prompt Injection Detection",sidebar_label:"Prompt Injection Detection",description:"Protect your workflow by detecting potentially harmful commands before they run."},d=void 0,h={},u=[{value:"How Detection Works",id:"how-detection-works",level:2},{value:"Enabling Detection",id:"enabling-detection",level:2},{value:"Configuring Detection Threshold",id:"configuring-detection-threshold",level:3},{value:"Enhanced Detection with Machine Learning",id:"enhanced-detection-with-machine-learning",level:2},{value:"Self-Hosting ML Detection Endpoints",id:"self-hosting-ml-detection-endpoints",level:4},{value:"See Also",id:"see-also",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Prompt injection happens when malicious instructions are hidden inside executable content. In the world of AI, prompt injection can be used to nudge AI agents (like goose) to run unsafe commands that compromise your environment or data."}),"\n",(0,s.jsx)(n.p,{children:"You can help protect your goose workflows by enabling prompt injection detection. This feature uses pattern matching to detect common attack techniques, including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Attempts to delete system files or directories"}),"\n",(0,s.jsx)(n.li,{children:"Commands that download and execute remote scripts"}),"\n",(0,s.jsx)(n.li,{children:"Attempts to access or exfiltrate sensitive data like SSH keys"}),"\n",(0,s.jsx)(n.li,{children:"System modifications that could compromise security"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["In addition, you can optionally enable ",(0,s.jsx)(n.a,{href:"#enhanced-detection-with-machine-learning",children:"ML-based scanning"})," using a specified model."]}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsx)(n.p,{children:"These checks provide a safeguard, not a guarantee. They detect known patterns but cannot catch all possible threats, especially novel or sophisticated attacks."})}),"\n",(0,s.jsx)(n.h2,{id:"how-detection-works",children:"How Detection Works"}),"\n",(0,s.jsx)(n.p,{children:"When enabled, goose uses a multi-layered approach to detect threats before they run:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tool call is intercepted and analyzed"})," - When goose prepares to execute a tool, the security system extracts the tool parameter text and checks it against ",(0,s.jsx)(n.a,{href:"https://github.com/block/goose/blob/main/crates/goose/src/security/patterns.rs",children:"threat patterns"}),". If ML-based detection is enabled, it also uses machine learning to analyze the semantic content of the tool call and recent conversation messages to better understand context and reduce false positives."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Risk is assessed"})," - Detected threats are assigned confidence scores"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Execution pauses"})," - Threats that exceed your configured threshold need your decision"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security alert appears"})," - The alert displays the confidence level, a description of the finding, and a unique finding ID. For example:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\ud83d\udd12 Security Alert: This tool call has been flagged as potentially dangerous.\n\nConfidence: 95%\nExplanation: Detected 1 security threat: Recursive file deletion with rm -rf\nFinding ID: SEC-abc123...\n\n[Allow Once] [Deny]\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"You choose"})," whether to proceed or cancel after reviewing the alert details. Note that:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Each decision is logged with its finding ID in the ",(0,s.jsx)(n.a,{href:"/docs/guides/logs#system-logs",children:"goose system logs"})]}),"\n",(0,s.jsx)(n.li,{children:"Allowed commands still run with your full permissions"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Responding to Alerts:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Read the explanation to understand what triggered the detection"}),"\n",(0,s.jsx)(n.li,{children:"Consider your context\u2014does this match what you're trying to do?"}),"\n",(0,s.jsx)(n.li,{children:"Try rephrasing your request more specifically"}),"\n",(0,s.jsx)(n.li,{children:"Check the source and be extra cautious with prompts from unknown sources"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When in doubt, deny."}),"\n",(0,s.jsx)(n.h2,{id:"enabling-detection",children:"Enabling Detection"}),"\n",(0,s.jsxs)(o.A,{groupId:"interface",children:[(0,s.jsx)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Click the ",(0,s.jsx)(l.A,{className:"inline",size:16})," button in the top-left to open the sidebar"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Settings"})," on the sidebar"]}),"\n",(0,s.jsxs)(n.li,{children:["Click the ",(0,s.jsx)(n.code,{children:"Chat"})," tab"]}),"\n",(0,s.jsxs)(n.li,{children:["Toggle ",(0,s.jsx)(n.code,{children:"Enable Prompt Injection Detection"})," to the on setting"]}),"\n",(0,s.jsxs)(n.li,{children:["Optionally adjust the ",(0,s.jsx)(n.code,{children:"Detection Threshold"})," to ",(0,s.jsx)(n.a,{href:"#configuring-detection-threshold",children:"configure the sensitivity"})]}),"\n",(0,s.jsxs)(n.li,{children:["Optionally enable ML-based detection:","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Toggle ",(0,s.jsx)(n.code,{children:"Enable ML-based Detection"})," to the on setting"]}),"\n",(0,s.jsxs)(n.li,{children:["Configure your inference endpoint:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Endpoint URL"}),": URL to the classification service (e.g., Hugging Face)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"API Token"}),": Authentication token if required by your service"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})}),(0,s.jsxs)(a.A,{value:"config",label:"goose config file",children:[(0,s.jsxs)(n.p,{children:["Add security prompt settings to your ",(0,s.jsx)(n.a,{href:"/docs/guides/config-files",children:(0,s.jsx)(n.code,{children:"config.yaml"})}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'SECURITY_PROMPT_ENABLED: true\nSECURITY_PROMPT_THRESHOLD: 0.8  # Optional, default is 0.8\n\n# Optional: Enable ML-based detection (Hugging Face example)\nSECURITY_PROMPT_CLASSIFIER_ENABLED: true\nSECURITY_PROMPT_CLASSIFIER_ENDPOINT: "https://router.huggingface.co/hf-inference/models/protectai/deberta-v3-base-prompt-injection-v2"\nSECURITY_PROMPT_CLASSIFIER_TOKEN: "YOUR_HUGGING_FACE_TOKEN"\n'})})]})]}),"\n",(0,s.jsxs)(n.admonition,{title:"Other Security Features",type:"info",children:[(0,s.jsx)(n.p,{children:"Beyond prompt injection detection, goose automatically:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Warns you before running new or updated recipes"}),"\n",(0,s.jsx)(n.li,{children:"Warns you when importing recipes that contain invisible Unicode Tag Block characters"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/troubleshooting/known-issues#malicious-package-detected",children:"Checks for known malware"})," when installing extensions for locally-run MCP servers"]}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"configuring-detection-threshold",children:"Configuring Detection Threshold"}),"\n",(0,s.jsx)(n.p,{children:"The threshold (0.01-1.0) controls how strict detection is:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Threshold"}),(0,s.jsx)(n.th,{children:"Sensitivity"}),(0,s.jsx)(n.th,{children:"Use When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"0.01-0.50"})}),(0,s.jsx)(n.td,{children:"Very lenient"}),(0,s.jsx)(n.td,{children:"You're experienced and understand the risks"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"0.50-0.70"})}),(0,s.jsx)(n.td,{children:"Balanced"}),(0,s.jsx)(n.td,{children:"General development work (good default)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"0.70-0.90"})}),(0,s.jsx)(n.td,{children:"Strict"}),(0,s.jsx)(n.td,{children:"Working with sensitive data or systems"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"0.90-1.00"})}),(0,s.jsx)(n.td,{children:"Maximum"}),(0,s.jsx)(n.td,{children:"High-security environments"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"When the injection prompt detection feature is enabled, the default threshold is 0.8 (recommended for most users)."}),"\n",(0,s.jsx)(n.p,{children:"Lower thresholds mean fewer alerts but might miss threats. Higher thresholds catch more potential issues but may flag legitimate operations. You can control this sensitivity/convenience tradeoff based on your needs."}),"\n",(0,s.jsx)(n.h2,{id:"enhanced-detection-with-machine-learning",children:"Enhanced Detection with Machine Learning"}),"\n",(0,s.jsx)(n.p,{children:"By default, prompt injection detection uses pattern matching, but you can optionally enable ML-based detection for improved accuracy and fewer false positives."}),"\n",(0,s.jsx)(n.p,{children:"ML-based detection:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Analyzes the semantic content of tool calls and recent messages"}),"\n",(0,s.jsx)(n.li,{children:"Detects sophisticated attacks that patterns might miss"}),"\n",(0,s.jsx)(n.li,{children:"Reduces false positives by understanding conversation context"}),"\n",(0,s.jsx)(n.li,{children:"Requires providing a classification endpoint URL and API token (if required)"}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Privacy Consideration",type:"warning",children:(0,s.jsx)(n.p,{children:"When ML-based detection is enabled, tool call content and recent messages are sent to the configured endpoint for analysis."})}),"\n",(0,s.jsx)(n.h4,{id:"self-hosting-ml-detection-endpoints",children:"Self-Hosting ML Detection Endpoints"}),"\n",(0,s.jsxs)(n.p,{children:["If you want to run your own classification endpoint, see the ",(0,s.jsx)(n.a,{href:"/docs/guides/security/classification-api-spec",children:"Classification API Specification"})," for implementation details. The API follows the Hugging Face Inference API format."]}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guides/goose-permissions",children:"goose Permission Modes"})," - Control goose's autonomy level"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guides/managing-tools/tool-permissions",children:"Managing Tool Permissions"})," - Fine-grained tool control"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},71112:(e,n,t)=>{t.d(n,{A:()=>i});const i=(0,t(75395).A)("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]])},75395:(e,n,t)=>{t.d(n,{A:()=>a});var i=t(96540);const s=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const o=(0,i.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:o,className:a="",children:l,iconNode:c,...d},h)=>(0,i.createElement)("svg",{ref:h,...r,width:n,height:n,stroke:e,strokeWidth:o?24*Number(t)/Number(n):t,className:s("lucide",a),...d},[...c.map(([e,n])=>(0,i.createElement)(e,n)),...Array.isArray(l)?l:[l]])),a=(e,n)=>{const t=(0,i.forwardRef)(({className:t,...r},a)=>{return(0,i.createElement)(o,{ref:a,iconNode:n,className:s(`lucide-${l=e,l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,t),...r});var l});return t.displayName=`${e}`,t}}}]);